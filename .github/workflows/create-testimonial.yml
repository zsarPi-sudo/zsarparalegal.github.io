name: Create Testimonial Issue

on:
  repository_dispatch:
    types: [new-testimonial]

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create Testimonial Issue
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.WEB3FORM }}
          script: |
            const { name, service, rating, feedback } = context.payload.client_payload;
            
            // Create star rating display
            const stars = '★'.repeat(parseInt(rating)) + '☆'.repeat(5 - parseInt(rating));
            
            // Create issue with testimonial
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Testimonial: ${name} - ${rating}★`,
              body: `**Service:** ${service}\n**Rating:** ${stars}\n\n**Feedback:**\n${feedback}\n\n---\n*Submitted: ${new Date().toLocaleDateString('en-IN')}*`,
              labels: ['testimonial', 'pending-review']
            });
            
            console.log('Testimonial issue created successfully');
